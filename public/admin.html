<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Админка | archimap</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ["Manrope", "Segoe UI", "Roboto", "Arial", "sans-serif"]
          },
          boxShadow: {
            soft: "0 8px 24px rgba(15, 23, 42, 0.08)"
          }
        }
      }
    };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    (function applyInitialTheme() {
      const key = 'archimap-theme';
      let theme = 'light';
      try {
        const stored = localStorage.getItem(key);
        if (stored === 'light' || stored === 'dark') {
          theme = stored;
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          theme = 'dark';
        }
      } catch {
        theme = 'light';
      }
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="min-h-screen bg-slate-100 font-sans text-slate-900">
  <div id="navigation" class="fixed inset-x-0 top-0 z-[930] px-3 pt-3 sm:px-4 sm:pt-4">
    <div class="relative rounded-2xl border border-slate-300 bg-white/95 px-3 py-2 shadow-soft backdrop-blur">
      <div class="flex items-center justify-between gap-3">
        <div class="flex min-w-0 items-center px-2">
          <a id="nav-logo-link" href="/" class="inline-flex h-10 select-none items-center text-2xl font-extrabold tracking-tight text-black sm:text-xl">/archimap</a>
          <a id="map-return-link" href="/" class="ml-3 inline-flex h-10 items-center rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-sm font-semibold text-slate-700 hover:bg-slate-50">Вернуться на карту</a>
        </div>
        <div class="flex items-center gap-2">
          <button id="nav-menu-button" type="button" class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-slate-300 bg-white text-slate-700 hover:bg-slate-50" aria-label="Открыть меню" aria-expanded="false">
            <svg viewBox="0 0 640 640" width="18" height="18" aria-hidden="true" class="fill-current">
              <path d="M96 160C96 142.3 110.3 128 128 128L512 128C529.7 128 544 142.3 544 160C544 177.7 529.7 192 512 192L128 192C110.3 192 96 177.7 96 160zM96 320C96 302.3 110.3 288 128 288L512 288C529.7 288 544 302.3 544 320C544 337.7 529.7 352 512 352L128 352C110.3 352 96 337.7 96 320zM544 480C544 497.7 529.7 512 512 512L128 512C110.3 512 96 497.7 96 480C96 462.3 110.3 448 128 448L512 448C529.7 448 544 462.3 544 480z"></path>
            </svg>
          </button>
        </div>
      </div>
      <div id="nav-menu-panel" class="pointer-events-none absolute right-0 top-[calc(100%+0.375rem)] sm:top-[calc(100%+0.75rem)] z-[960] flex w-64 flex-col gap-2 rounded-xl border border-slate-300 bg-white/95 p-2 shadow-soft transition-all duration-200 ease-out origin-top-right max-h-0 -translate-y-2 scale-95 overflow-hidden opacity-0">
        <a href="/admin/" class="block rounded-lg px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100">Админ-панель</a>
        <a href="/account/" class="block rounded-lg px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100">Кабинет пользователя</a>
        <div class="my-2 border-t border-slate-200"></div>
        <div class="flex items-center justify-between rounded-lg px-3 py-2">
          <span class="text-sm font-semibold text-slate-700">Тема</span>
          <label for="theme-toggle" class="relative inline-flex h-10 w-[76px] cursor-pointer items-center rounded-full bg-white/95 shadow-soft hover:bg-slate-50">
            <input id="theme-toggle" type="checkbox" class="peer sr-only" aria-label="Переключить тему" />
            <span class="absolute inset-1 rounded-full bg-slate-300 transition peer-checked:bg-indigo-500"></span>
            <span class="pointer-events-none absolute left-1.5 z-[3] inline-flex h-7 w-7 items-center justify-center" aria-hidden="true">
              <svg class="theme-track-icon-sun h-[14px] w-[14px] fill-current text-slate-700" viewBox="0 0 640 640">
                <path d="M320 32C328.4 32 336.3 36.4 340.6 43.7L396.1 136.3L500.9 110C509.1 108 517.8 110.4 523.7 116.3C529.6 122.2 532 131 530 139.1L503.7 243.8L596.4 299.3C603.6 303.6 608.1 311.5 608.1 319.9C608.1 328.3 603.7 336.2 596.4 340.5L503.7 396.1L530 500.8C532 509 529.6 517.7 523.7 523.6C517.8 529.5 509 532 500.9 530L396.2 503.7L340.7 596.4C336.4 603.6 328.5 608.1 320.1 608.1C311.7 608.1 303.8 603.7 299.5 596.4L243.9 503.7L139.2 530C131 532 122.4 529.6 116.4 523.7C110.4 517.8 108 509 110 500.8L136.2 396.1L43.6 340.6C36.4 336.2 32 328.4 32 320C32 311.6 36.4 303.7 43.7 299.4L136.3 243.9L110 139.1C108 130.9 110.3 122.3 116.3 116.3C122.3 110.3 131 108 139.2 110L243.9 136.2L299.4 43.6L301.2 41C305.7 35.3 312.6 31.9 320 31.9zM320 176C240.5 176 176 240.5 176 320C176 399.5 240.5 464 320 464C399.5 464 464 399.5 464 320C464 240.5 399.5 176 320 176zM320 416C267 416 224 373 224 320C224 267 267 224 320 224C373 224 416 267 416 320C416 373 373 416 320 416z"></path>
              </svg>
            </span>
            <span class="pointer-events-none absolute right-1.5 z-[3] inline-flex h-7 w-7 items-center justify-center" aria-hidden="true">
              <svg class="theme-track-icon-moon h-[14px] w-[14px] fill-current text-slate-700" viewBox="0 0 640 640">
                <path d="M320 64C178.6 64 64 178.6 64 320C64 461.4 178.6 576 320 576C388.8 576 451.3 548.8 497.3 504.6C504.6 497.6 506.7 486.7 502.6 477.5C498.5 468.3 488.9 462.6 478.8 463.4C473.9 463.8 469 464 464 464C362.4 464 280 381.6 280 280C280 207.9 321.5 145.4 382.1 115.2C391.2 110.7 396.4 100.9 395.2 90.8C394 80.7 386.6 72.5 376.7 70.3C358.4 66.2 339.4 64 320 64z"></path>
              </svg>
            </span>
            <span class="pointer-events-none absolute left-1.5 z-[2] inline-flex h-7 w-7 items-center justify-center rounded-full bg-white shadow-sm transition peer-checked:translate-x-[36px]"></span>
          </label>
        </div>
        <button id="admin-logout-btn" type="button" class="mt-2 w-full rounded-lg bg-rose-500 px-3 py-2 text-sm font-semibold text-white hover:bg-rose-600">Выход</button>
      </div>
    </div>
  </div>

  <div id="admin-loading" class="w-full px-3 pb-3 pt-[5.5rem] sm:px-4 sm:pb-4 sm:pt-[6rem]">
    <div class="mx-auto max-w-2xl rounded-2xl border border-slate-200 bg-white p-6 text-center shadow-soft">
      <p class="text-sm font-semibold text-slate-700">Проверка доступа...</p>
    </div>
  </div>

  <div id="admin-app" class="hidden w-full px-3 pb-3 pt-[5.5rem] sm:px-4 sm:pb-4 sm:pt-[5.25rem]">
    <div class="mb-3 rounded-2xl border border-slate-200 bg-white p-4 shadow-soft sm:mb-4">
      <h1 class="text-xl font-extrabold md:text-2xl">Админ-панель</h1>
      <p id="admin-subtitle" class="mt-1 text-sm text-slate-600">Пользователи и локальные правки</p>
    </div>

    <div class="mb-3 inline-flex w-fit rounded-lg border border-slate-300 bg-white p-1 shadow-soft sm:mb-4">
      <button id="tab-users" type="button" class="rounded-md px-3 py-1.5 text-sm font-semibold text-slate-700 hover:bg-slate-100">Пользователи</button>
      <button id="tab-edits" type="button" class="rounded-md px-3 py-1.5 text-sm font-semibold text-slate-700 hover:bg-slate-100">Правки</button>
    </div>

    <section id="users-panel" class="space-y-4">
      <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-soft">
        <div class="grid gap-2 md:grid-cols-6">
          <input id="users-search" type="search" placeholder="Поиск по email/ФИО" class="md:col-span-2 w-full rounded-lg border border-slate-300 bg-slate-50 px-3 py-2 text-sm" />
          <select id="users-role-filter" class="w-full rounded-lg border border-slate-300 bg-slate-50 px-3 py-2 text-sm">
            <option value="">Роль: все</option>
            <option value="admin">Только admin</option>
            <option value="user">Только user</option>
          </select>
          <select id="users-can-edit-filter" class="w-full rounded-lg border border-slate-300 bg-slate-50 px-3 py-2 text-sm">
            <option value="">Право редактирования: все</option>
            <option value="true">Только разрешено</option>
            <option value="false">Только запрещено</option>
          </select>
          <select id="users-has-edits-filter" class="w-full rounded-lg border border-slate-300 bg-slate-50 px-3 py-2 text-sm">
            <option value="">Правки: все</option>
            <option value="true">Только с правками</option>
            <option value="false">Только без правок</option>
          </select>
          <div class="flex gap-2">
            <button id="users-refresh" type="button" class="w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100">Обновить</button>
          </div>
        </div>
        <div class="mt-2 grid gap-2 md:grid-cols-4">
          <select id="users-sort-by" class="w-full rounded-lg border border-slate-300 bg-slate-50 px-3 py-2 text-sm">
            <option value="createdAt">Сортировка: дата создания</option>
            <option value="email">Email</option>
            <option value="firstName">Имя</option>
            <option value="lastName">Фамилия</option>
            <option value="editsCount">Количество правок</option>
            <option value="lastEditAt">Последняя правка</option>
            <option value="isAdmin">Роль</option>
            <option value="canEdit">Право редактирования</option>
          </select>
          <select id="users-sort-dir" class="w-full rounded-lg border border-slate-300 bg-slate-50 px-3 py-2 text-sm">
            <option value="desc">По убыванию</option>
            <option value="asc">По возрастанию</option>
          </select>
        </div>
      </div>

      <div class="grid gap-4 lg:grid-cols-[1.4fr_1fr]">
        <div class="overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-soft">
          <div class="border-b border-slate-200 px-4 py-3">
            <p id="users-status" class="text-sm text-slate-600">Загрузка...</p>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full text-sm">
              <thead class="bg-slate-50 text-xs uppercase tracking-wide text-slate-500">
                <tr>
                  <th class="px-4 py-3 text-left">Пользователь</th>
                  <th class="px-4 py-3 text-left">Роль</th>
                  <th class="px-4 py-3 text-left">Правки</th>
                  <th class="px-4 py-3 text-left">Создан</th>
                  <th class="px-4 py-3 text-right">Действия</th>
                </tr>
              </thead>
              <tbody id="users-list"></tbody>
            </table>
          </div>
        </div>

        <aside class="rounded-2xl border border-slate-200 bg-white p-4 shadow-soft">
          <h2 class="text-base font-bold">Пользователь</h2>
          <p id="user-detail-status" class="mt-1 text-sm text-slate-600">Выберите пользователя в таблице.</p>
          <div id="user-detail" class="mt-3 hidden space-y-3">
            <div class="rounded-lg border border-slate-200 bg-slate-50 p-3 text-sm">
              <p id="user-detail-name" class="font-semibold text-slate-900"></p>
              <p id="user-detail-email" class="text-slate-600"></p>
              <p id="user-detail-meta" class="mt-1 text-xs text-slate-500"></p>
            </div>
            <div class="max-h-[50vh] overflow-y-auto space-y-2" id="user-edits-list"></div>
          </div>
        </aside>
      </div>
    </section>

    <section id="edits-panel" class="hidden space-y-4">
      <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-soft">
        <p id="edits-status" class="text-sm text-slate-600">Загрузка...</p>
      </div>
      <div id="edits-list" class="grid gap-3 md:grid-cols-2 xl:grid-cols-3"></div>
    </section>
  </div>

  <div id="edit-detail-modal" class="fixed inset-0 z-[1200] hidden bg-slate-900/40 p-3 md:p-6">
    <div class="mx-auto max-w-3xl rounded-2xl border border-slate-200 bg-white p-4 shadow-soft md:p-5">
      <div class="mb-3 flex items-center justify-between gap-2 border-b border-slate-200 pb-2">
        <h3 id="edit-detail-title" class="text-lg font-bold">Правка</h3>
        <button id="edit-detail-close" type="button" class="inline-flex h-8 w-8 items-center justify-center rounded-lg border border-slate-300 bg-white text-slate-600 hover:bg-slate-100">✕</button>
      </div>
      <p id="edit-detail-meta" class="text-sm text-slate-600"></p>
      <div id="edit-detail-list" class="mt-3 space-y-2"></div>
    </div>
  </div>

  <script src="/i18n/ru.js"></script>
  <script src="/admin.js"></script>
</body>
</html>
