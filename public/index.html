<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ArchiMap</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.5.2/flowbite.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ["Manrope", "Segoe UI", "Roboto", "Arial", "sans-serif"]
          },
          colors: {
            brand: {
              ink: "#0F172A",
              mute: "#64748B",
              purple: "#5B62F0",
              coral: "#FF6B7F"
            }
          },
          boxShadow: {
            float: "0 20px 40px rgba(15, 23, 42, 0.12)",
            soft: "0 8px 20px rgba(15, 23, 42, 0.06)"
          }
        }
      }
    };
  </script>
  <script>
    (function applyInitialTheme() {
      const key = 'archimap-theme';
      let theme = 'light';
      try {
        const stored = localStorage.getItem(key);
        if (stored === 'light' || stored === 'dark') {
          theme = stored;
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          theme = 'dark';
        }
      } catch {
        theme = 'light';
      }
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>
  <link href="https://unpkg.com/maplibre-gl@5.1.0/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    html[data-theme='dark'] {
      color-scheme: dark;
    }

    body {
      transition: background-color 0.22s ease, color 0.22s ease;
    }

    .maplibregl-ctrl-group {
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.22);
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
      overflow: hidden;
    }

    .maplibregl-ctrl button {
      background: rgba(255, 255, 255, 0.95);
    }

    .maplibregl-ctrl-top-right .maplibregl-ctrl {
      margin: 16px 18px 0 0;
    }

    .maplibregl-ctrl-top-right .maplibregl-ctrl-group {
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.32);
      background: rgba(255, 255, 255, 0.96);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.12);
      backdrop-filter: blur(6px);
      overflow: hidden;
    }

    .maplibregl-ctrl-top-right .maplibregl-ctrl button {
      width: 36px;
      height: 36px;
      border-radius: 0;
      border: 0;
      background: transparent;
      color: #334155;
      transition: background-color 0.2s ease, color 0.2s ease;
    }

    .maplibregl-ctrl-top-right .maplibregl-ctrl button + button {
      border-top: 1px solid rgba(148, 163, 184, 0.24);
    }

    .maplibregl-ctrl-top-right .maplibregl-ctrl button:hover {
      background: rgba(241, 245, 249, 0.95);
      color: #0f172a;
    }

    .maplibregl-ctrl-top-right .maplibregl-ctrl button:active {
      background: rgba(226, 232, 240, 0.95);
    }

    #theme-icon-sun,
    #theme-icon-moon {
      transition: color 0.22s ease, opacity 0.22s ease;
    }

    html[data-theme='light'] #theme-icon-sun {
      color: #0f172a;
      opacity: 0.95;
    }

    html[data-theme='light'] #theme-icon-moon {
      color: #64748b;
      opacity: 0.8;
    }

    html[data-theme='dark'] #theme-icon-sun {
      color: #94a3b8;
      opacity: 0.78;
    }

    html[data-theme='dark'] #theme-icon-moon {
      color: #e2e8f0;
      opacity: 0.98;
    }

    html[data-theme='dark'] body {
      background: #0b1220;
      color: #e2e8f0;
    }

    html[data-theme='dark'] .text-brand-ink,
    html[data-theme='dark'] .text-black,
    html[data-theme='dark'] .text-slate-900,
    html[data-theme='dark'] .text-slate-800,
    html[data-theme='dark'] .text-slate-700,
    html[data-theme='dark'] .text-gray-900 {
      color: #e2e8f0 !important;
    }

    html[data-theme='dark'] .text-slate-600,
    html[data-theme='dark'] .text-slate-500,
    html[data-theme='dark'] .text-gray-500,
    html[data-theme='dark'] .text-gray-400 {
      color: #94a3b8 !important;
    }

    html[data-theme='dark'] .bg-white,
    html[data-theme='dark'] .bg-white\/95,
    html[data-theme='dark'] .bg-slate-50,
    html[data-theme='dark'] .bg-gray-50,
    html[data-theme='dark'] .bg-white\/90 {
      background-color: #111a2d !important;
    }

    html[data-theme='dark'] .bg-slate-100 {
      background-color: #0b1220 !important;
    }

    html[data-theme='dark'] .border-slate-300,
    html[data-theme='dark'] .border-slate-200,
    html[data-theme='dark'] .border-gray-300,
    html[data-theme='dark'] .border-gray-200,
    html[data-theme='dark'] .border-white\/40 {
      border-color: #2a3650 !important;
    }

    html[data-theme='dark'] .hover\:bg-slate-50:hover,
    html[data-theme='dark'] .hover\:bg-slate-100:hover,
    html[data-theme='dark'] .hover\:bg-gray-100:hover {
      background-color: #18233a !important;
    }

    html[data-theme='dark'] #filter-shell,
    html[data-theme='dark'] #building-modal > div,
    html[data-theme='dark'] #auth-modal .relative.rounded-xl,
    html[data-theme='dark'] #admin-edits-modal .relative.rounded-xl,
    html[data-theme='dark'] #modal-content .rounded-2xl,
    html[data-theme='dark'] #modal-content details,
    html[data-theme='dark'] #modal-content pre,
    html[data-theme='dark'] #building-edit-form {
      background-color: #111a2d !important;
      border-color: #2a3650 !important;
      color: #e2e8f0 !important;
    }

    html[data-theme='dark'] #auth-modal,
    html[data-theme='dark'] #admin-edits-modal {
      background: rgba(2, 6, 23, 0.65) !important;
    }

    html[data-theme='dark'] .maplibregl-ctrl-group {
      border-color: rgba(74, 85, 104, 0.45);
      box-shadow: 0 10px 24px rgba(2, 6, 23, 0.5);
    }

    html[data-theme='dark'] .maplibregl-ctrl button {
      background: rgba(15, 23, 42, 0.92);
      color: #dbeafe;
    }

    html[data-theme='dark'] .maplibregl-ctrl-top-right .maplibregl-ctrl-group {
      border-color: rgba(71, 85, 105, 0.7);
      background: rgba(15, 23, 42, 0.92);
      box-shadow: 0 12px 28px rgba(2, 6, 23, 0.62);
    }

    html[data-theme='dark'] .maplibregl-ctrl-top-right .maplibregl-ctrl button {
      color: #cbd5e1;
    }

    html[data-theme='dark'] .maplibregl-ctrl-top-right .maplibregl-ctrl button + button {
      border-top-color: rgba(71, 85, 105, 0.62);
    }

    html[data-theme='dark'] .maplibregl-ctrl-top-right .maplibregl-ctrl button:hover {
      background: rgba(30, 41, 59, 0.95);
      color: #f1f5f9;
    }

    html[data-theme='dark'] .maplibregl-ctrl-top-right .maplibregl-ctrl button:active {
      background: rgba(51, 65, 85, 0.9);
    }

    html[data-theme='dark'] .maplibregl-ctrl-top-right .maplibregl-ctrl .maplibregl-ctrl-icon {
      filter: brightness(0) invert(1);
    }
  </style>
</head>
<body class="font-sans text-brand-ink bg-slate-100">
  <div id="map" class="fixed inset-0"></div>

  <div class="fixed top-4 left-5 z-[905] sm:top-3 sm:left-3">
    <div class="select-none text-3xl font-extrabold tracking-tight text-black drop-shadow-sm sm:text-2xl">/archimap</div>
    <div id="filter-shell" class="mt-2 w-[240px] max-w-[calc(100vw-1.5rem)] rounded-xl border border-slate-300 bg-white/95 p-2 shadow-soft transition-all duration-200">
      <div id="filter-compact">
        <button id="filter-toggle-btn" type="button" class="inline-flex w-full items-center gap-2 rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-sm font-semibold text-slate-800 hover:bg-slate-50">
          <svg viewBox="0 0 512 512" width="14" height="14" aria-hidden="true" class="fill-current">
            <path d="M3.9 54.9C10.5 40.9 24.5 32 40 32l432 0c15.5 0 29.5 8.9 36.1 22.9s4.6 30.5-5.2 42.5L320 320.9 320 448c0 12.1-6.8 23.2-17.7 28.6s-23.8 4.3-33.5-3l-64-48c-8.1-6-12.8-15.5-12.8-25.6l0-79.1L9 97.3C-.7 85.4-2.8 68.8 3.9 54.9z"></path>
          </svg>
          Фильтр
        </button>
        <label for="labels-toggle" class="mt-2 inline-flex w-full cursor-pointer items-center justify-between rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-sm font-semibold text-slate-800 hover:bg-slate-50">
          <span class="leading-none">Показывать обозначения</span>
          <span class="relative inline-flex h-5 w-9 items-center">
            <input id="labels-toggle" type="checkbox" class="peer sr-only" checked />
            <span class="absolute inset-0 rounded-full bg-slate-300 transition peer-checked:bg-indigo-500"></span>
            <span class="absolute left-0.5 h-4 w-4 rounded-full bg-white shadow-sm transition peer-checked:translate-x-[14px]"></span>
          </span>
        </label>
      </div>
      <div id="filter-panel" class="hidden">
        <div class="mb-3 flex items-center justify-between">
          <h3 class="text-base font-extrabold text-slate-900">Фильтр OSM тегов</h3>
          <button id="filter-close-btn" type="button" class="inline-flex h-8 w-8 items-center justify-center rounded-lg text-slate-500 hover:bg-slate-100 hover:text-slate-900" aria-label="Закрыть">
            <svg class="h-3 w-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 12 12M13 1 1 13"/>
            </svg>
          </button>
        </div>
        <p class="mb-3 text-xs text-slate-600">Критерии применяются к тегам OSM у загруженных зданий.</p>
        <form id="filter-form" class="space-y-3">
          <div id="filter-rows" class="space-y-2"></div>
          <div class="flex items-center gap-2">
            <button id="filter-add-row-btn" type="button" class="rounded-lg border border-slate-300 bg-white px-2.5 py-1.5 text-xs font-semibold text-slate-700 hover:bg-slate-50">+ Критерий</button>
            <button id="filter-reset-btn" type="button" class="rounded-lg border border-slate-300 bg-white px-2.5 py-1.5 text-xs font-semibold text-slate-700 hover:bg-slate-50">Сброс</button>
          </div>
        </form>
        <p id="filter-status" class="mt-3 text-xs text-slate-600">Фильтр не активен.</p>
        <datalist id="filter-tag-keys"></datalist>
      </div>
    </div>
  </div>

  <div class="fixed left-6 bottom-6 z-[910] flex items-center gap-2 sm:left-3 sm:bottom-3">
    <label for="theme-toggle" class="relative inline-flex h-10 w-[76px] cursor-pointer items-center rounded-full border border-slate-300 bg-white/95 shadow-soft hover:bg-slate-50">
      <input id="theme-toggle" type="checkbox" class="peer sr-only" aria-label="Переключить тему" />
      <span class="absolute inset-1 rounded-full bg-slate-300 transition peer-checked:bg-indigo-500"></span>
      <span id="theme-icon-sun" class="pointer-events-none absolute left-2 z-[1] inline-flex h-4 w-4 items-center justify-center" aria-hidden="true">
        <svg viewBox="0 0 512 512" width="14" height="14" class="fill-current">
          <path d="M256 144a112 112 0 1 0 0 224 112 112 0 1 0 0-224zm0-112c17.7 0 32 14.3 32 32l0 16c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-16c0-17.7 14.3-32 32-32zm0 368c17.7 0 32 14.3 32 32l0 16c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-16c0-17.7 14.3-32 32-32zM80 224l16 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-16 0c-17.7 0-32-14.3-32-32s14.3-32 32-32zm336 0l16 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-16 0c-17.7 0-32-14.3-32-32s14.3-32 32-32zM123.7 123.7c12.5-12.5 32.8-12.5 45.3 0l11.3 11.3c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0l-11.3-11.3c-12.5-12.5-12.5-32.8 0-45.3zm208 208c12.5-12.5 32.8-12.5 45.3 0l11.3 11.3c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L331.7 377c-12.5-12.5-12.5-32.8 0-45.3zm56.6-208c12.5 12.5 12.5 32.8 0 45.3L377 180.3c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L343 123.7c12.5-12.5 32.8-12.5 45.3 0zM180.3 331.7c12.5 12.5 12.5 32.8 0 45.3L169 388.3c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L135 331.7c12.5-12.5 32.8-12.5 45.3 0z"></path>
        </svg>
      </span>
      <span id="theme-icon-moon" class="pointer-events-none absolute right-2 z-[1] inline-flex h-4 w-4 items-center justify-center" aria-hidden="true">
        <svg viewBox="0 0 384 512" width="12" height="12" class="fill-current">
          <path d="M223.5 32c16.7 0 33.3 1.8 49.4 5.3c10.2 2.2 18.4 9.8 21.3 19.9s0 21-7.4 28.3C244.5 127.8 224 189.6 224 256s20.5 128.2 62.8 170.5c7.4 7.4 10.2 18.3 7.4 28.3s-11.1 17.6-21.3 19.9c-16.1 3.5-32.7 5.3-49.4 5.3C100.1 480 0 379.9 0 256S100.1 32 223.5 32z"></path>
        </svg>
      </span>
      <span class="pointer-events-none absolute left-1.5 h-7 w-7 rounded-full bg-white shadow-sm transition peer-checked:translate-x-[36px]">
      </span>
    </label>

    <button id="auth-fab" class="grid h-12 w-12 place-items-center rounded-xl border border-white/40 bg-gradient-to-br from-brand-purple to-indigo-400 text-white shadow-float transition hover:-translate-y-0.5" type="button" aria-label="Вход">
      <svg id="auth-icon-login" viewBox="0 0 512 512" width="18" height="18" aria-hidden="true" class="fill-current">
        <path d="M217.9 105.9L340.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L217.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1L32 320c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM352 416l64 0c17.7 0 32-14.3 32-32l0-256c0-17.7-14.3-32-32-32l-64 0c-17.7 0-32-14.3-32-32s14.3-32 32-32l64 0c53 0 96 43 96 96l0 256c0 53-43 96-96 96l-64 0c-17.7 0-32-14.3-32-32s14.3-32 32-32z"></path>
      </svg>
      <svg id="auth-icon-user" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="18" height="18" aria-hidden="true" class="hidden fill-current">
        <path d="M320 312C386.3 312 440 258.3 440 192C440 125.7 386.3 72 320 72C253.7 72 200 125.7 200 192C200 258.3 253.7 312 320 312zM290.3 368C191.8 368 112 447.8 112 546.3C112 562.7 125.3 576 141.7 576L498.3 576C514.7 576 528 562.7 528 546.3C528 447.8 448.2 368 349.7 368L290.3 368z"></path>
      </svg>
    </button>

    <button id="admin-edits-fab" class="hidden grid h-12 w-12 place-items-center rounded-xl border border-white/40 bg-gradient-to-br from-rose-600 to-red-500 text-white shadow-float transition hover:-translate-y-0.5" type="button" aria-label="Список правок">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="18" height="18" aria-hidden="true" class="fill-current">
        <path d="M128.1 64C92.8 64 64.1 92.7 64.1 128L64.1 512C64.1 547.3 92.8 576 128.1 576L274.3 576L285.2 521.5C289.5 499.8 300.2 479.9 315.8 464.3L448 332.1L448 234.6C448 217.6 441.3 201.3 429.3 189.3L322.8 82.7C310.8 70.7 294.5 64 277.6 64L128.1 64zM389.6 240L296.1 240C282.8 240 272.1 229.3 272.1 216L272.1 122.5L389.6 240zM332.3 530.9L320.4 590.5C320.2 591.4 320.1 592.4 320.1 593.4C320.1 601.4 326.6 608 334.7 608C335.7 608 336.6 607.9 337.6 607.7L397.2 595.8C409.6 593.3 421 587.2 429.9 578.3L548.8 459.4L468.8 379.4L349.9 498.3C341 507.2 334.9 518.6 332.4 531zM600.1 407.9C622.2 385.8 622.2 350 600.1 327.9C578 305.8 542.2 305.8 520.1 327.9L491.3 356.7L571.3 436.7L600.1 407.9z"></path>
      </svg>
    </button>
  </div>

  <div id="building-modal" class="fixed inset-0 z-50 hidden pointer-events-none" aria-hidden="true">
    <div class="pointer-events-auto absolute inset-3 overflow-auto rounded-2xl border border-slate-200 bg-white shadow-float md:inset-y-4 md:right-4 md:left-auto md:w-[calc(50%-1rem)] lg:w-[46%]">
      <div class="sticky top-0 z-10 flex items-center justify-between border-b border-slate-200 bg-white/95 px-4 py-3 backdrop-blur md:px-5">
        <h2 class="text-xl font-extrabold text-slate-900 md:text-2xl">Информация о здании</h2>
        <button id="modal-close" class="flex h-10 w-10 items-center justify-center rounded-lg border border-gray-200 bg-white text-gray-500 hover:bg-gray-100 hover:text-gray-900" type="button" aria-label="Закрыть">
          <svg class="h-3 w-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 12 12M13 1 1 13"/>
          </svg>
        </button>
      </div>
      <div id="modal-content" class="px-4 pt-4 pb-5 md:px-5 md:pt-5 md:pb-6"></div>
    </div>
  </div>

  <div id="auth-modal" class="fixed inset-0 z-[1200] hidden h-full w-full overflow-y-auto overflow-x-hidden bg-slate-900/35 p-4 backdrop-blur-sm md:p-6" aria-hidden="true">
    <div class="relative mx-auto mt-20 w-full max-w-md max-h-full">
      <div class="relative rounded-xl bg-white shadow-xl">
        <div class="flex items-center justify-between rounded-t border-b border-slate-200 p-4 md:p-5">
          <h3 class="text-xl font-semibold text-gray-900">Авторизация</h3>
          <button id="auth-modal-close" type="button" class="inline-flex h-8 w-8 items-center justify-center rounded-lg text-sm text-gray-400 hover:bg-gray-100 hover:text-gray-900" aria-label="Закрыть">
            <svg class="h-3 w-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 12 12M13 1 1 13"/>
            </svg>
          </button>
        </div>
        <div class="space-y-4 p-4 md:p-5">
          <form id="login-form" class="space-y-3">
            <input id="login-username" class="w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-indigo-500 focus:ring-indigo-500" placeholder="Логин" required />
            <input id="login-password" class="w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-indigo-500 focus:ring-indigo-500" type="password" placeholder="Пароль" required />
            <button class="w-full rounded-lg bg-indigo-600 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300" type="submit">Войти</button>
          </form>
          <p id="auth-status" class="text-sm text-gray-500"></p>
          <button id="logout-btn" class="hidden w-full rounded-lg bg-rose-500 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-rose-600 focus:outline-none focus:ring-4 focus:ring-rose-200" type="button">Выйти</button>
        </div>
      </div>
    </div>
  </div>

  <div id="admin-edits-modal" class="fixed inset-0 z-[1200] hidden h-full w-full overflow-y-auto overflow-x-hidden bg-slate-900/35 p-4 backdrop-blur-sm md:p-6" aria-hidden="true">
    <div class="relative mx-auto mt-8 w-full max-w-3xl max-h-full">
      <div class="relative rounded-xl bg-white shadow-xl">
        <div class="flex items-center justify-between rounded-t border-b border-slate-200 p-4 md:p-5">
          <h3 class="text-xl font-semibold text-gray-900">Локальные правки зданий</h3>
          <button id="admin-edits-close" type="button" class="inline-flex h-8 w-8 items-center justify-center rounded-lg text-sm text-gray-400 hover:bg-gray-100 hover:text-gray-900" aria-label="Закрыть">
            <svg class="h-3 w-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 12 12M13 1 1 13"/>
            </svg>
          </button>
        </div>
        <div class="p-4 md:p-5">
          <p id="admin-edits-status" class="mb-3 text-sm text-slate-600">Загрузка...</p>
          <div id="admin-edits-list" class="max-h-[70vh] space-y-3 overflow-y-auto pr-1"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/maplibre-gl@5.1.0/dist/maplibre-gl.js"></script>
  <script src="/main.js"></script>
</body>
</html>
