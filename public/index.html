<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>archimap</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ["Manrope", "Segoe UI", "Roboto", "Arial", "sans-serif"]
          },
          colors: {
            brand: {
              ink: "#0F172A",
              mute: "#64748B",
              purple: "#5B62F0",
              coral: "#FF6B7F"
            }
          },
          boxShadow: {
            float: "0 20px 40px rgba(15, 23, 42, 0.12)",
            soft: "0 8px 20px rgba(15, 23, 42, 0.06)"
          }
        }
      }
    };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    (function applyInitialTheme() {
      const key = 'archimap-theme';
      let theme = 'light';
      try {
        const stored = localStorage.getItem(key);
        if (stored === 'light' || stored === 'dark') {
          theme = stored;
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          theme = 'dark';
        }
      } catch {
        theme = 'light';
      }
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>
  <link href="https://unpkg.com/maplibre-gl@5.1.0/dist/maplibre-gl.css" rel="stylesheet" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="font-sans text-brand-ink bg-slate-100">
  <div id="map" class="fixed inset-0"></div>

  <div id="top-nav-root"></div>

  <div id="building-modal" class="fixed inset-0 z-50 hidden pointer-events-none" aria-hidden="true">
    <div class="pointer-events-auto absolute inset-3 overflow-auto rounded-2xl border border-slate-200 bg-white shadow-float md:inset-y-4 md:right-4 md:left-auto md:w-[calc(50%-1rem)] lg:w-[46%]">
      <div class="sticky top-0 z-10 flex items-center justify-between border-b border-slate-200 bg-white/95 p-4 backdrop-blur md:p-5">
        <h2 class="text-xl font-extrabold text-slate-900 md:text-2xl">Информация о здании</h2>
        <button id="modal-close" type="button" class="inline-flex h-8 w-8 items-center justify-center rounded-lg text-sm text-gray-400 hover:bg-gray-100 hover:text-gray-900" aria-label="Закрыть">
          <svg class="h-3 w-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 12 12M13 1 1 13"/>
          </svg>
        </button>
      </div>
      <div id="modal-content" class="px-3 pt-3 pb-4 md:px-4 md:pt-4 md:pb-5"></div>
    </div>
  </div>

  <div id="auth-modal" class="fixed inset-0 z-[1200] hidden h-full w-full overflow-y-auto overflow-x-hidden bg-slate-900/35 p-4 backdrop-blur-sm md:p-6" aria-hidden="true">
    <div class="relative mx-auto mt-16 w-full max-w-md">
      <div class="overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-float">
        <div class="flex items-center justify-between border-b border-slate-200 px-4 py-4 md:px-5">
          <h3 class="text-lg font-extrabold text-slate-900">Вход в archimap</h3>
          <button id="auth-modal-close" type="button" class="inline-flex h-8 w-8 items-center justify-center rounded-lg text-sm text-slate-400 hover:bg-slate-100 hover:text-slate-900" aria-label="Закрыть">
            <svg class="h-3 w-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 12 12M13 1 1 13"/>
            </svg>
          </button>
        </div>

        <div class="px-4 pt-4 md:px-5">
          <div class="ui-tab-shell grid grid-cols-2 gap-1">
            <button id="auth-tab-login" type="button" class="ui-tab-btn">Вход</button>
            <button id="auth-tab-register" type="button" class="ui-tab-btn">Регистрация</button>
          </div>
        </div>

        <div class="space-y-4 p-4 md:p-5">
          <section id="auth-login-panel" class="space-y-3">
            <form id="login-form" class="space-y-3">
              <input id="login-username" class="w-full rounded-lg border border-slate-300 bg-slate-50 p-2.5 text-sm text-slate-900 focus:border-indigo-500 focus:ring-indigo-500" placeholder="Email" required />
              <input id="login-password" class="w-full rounded-lg border border-slate-300 bg-slate-50 p-2.5 text-sm text-slate-900 focus:border-indigo-500 focus:ring-indigo-500" type="password" placeholder="Пароль" required />
              <button id="forgot-password-toggle" type="button" class="w-full text-right text-xs font-semibold text-indigo-600 hover:text-indigo-700">Забыли пароль?</button>
              <button class="w-full rounded-lg bg-indigo-600 px-5 py-2.5 text-center text-sm font-semibold text-white hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300" type="submit">Войти</button>
            </form>
          </section>

          <section id="register-panel" class="hidden space-y-3">
            <form id="register-form" class="space-y-3">
              <div class="grid grid-cols-2 gap-2">
                <div>
                  <label for="register-first-name" class="mb-1 block text-xs font-semibold text-slate-600">Имя (необязательно)</label>
                  <input id="register-first-name" class="w-full rounded-lg border border-slate-300 bg-slate-50 p-2.5 text-sm text-slate-900 focus:border-sky-500 focus:ring-sky-500" placeholder="Имя" />
                </div>
                <div>
                  <label for="register-last-name" class="mb-1 block text-xs font-semibold text-slate-600">Фамилия (необязательно)</label>
                  <input id="register-last-name" class="w-full rounded-lg border border-slate-300 bg-slate-50 p-2.5 text-sm text-slate-900 focus:border-sky-500 focus:ring-sky-500" placeholder="Фамилия" />
                </div>
              </div>
              <div>
                <label for="register-email" class="mb-1 block text-xs font-semibold text-slate-700">Email *</label>
                <input id="register-email" class="w-full rounded-lg border border-slate-300 bg-slate-50 p-2.5 text-sm text-slate-900 focus:border-sky-500 focus:ring-sky-500" type="email" placeholder="Email" required />
              </div>
              <div>
                <label for="register-password" class="mb-1 block text-xs font-semibold text-slate-700">Пароль *</label>
                <input id="register-password" class="w-full rounded-lg border border-slate-300 bg-slate-50 p-2.5 text-sm text-slate-900 focus:border-sky-500 focus:ring-sky-500" type="password" placeholder="Пароль" required />
              </div>
              <div>
                <label for="register-password-confirm" class="mb-1 block text-xs font-semibold text-slate-700">Повторите пароль *</label>
                <input id="register-password-confirm" class="w-full rounded-lg border border-slate-300 bg-slate-50 p-2.5 text-sm text-slate-900 focus:border-sky-500 focus:ring-sky-500" type="password" placeholder="Повторите пароль" required />
              </div>
              <div class="space-y-2 rounded-lg border border-slate-200 bg-slate-50 p-3">
                <label class="flex items-start gap-2 text-xs text-slate-700">
                  <input id="register-accept-user-agreement" type="checkbox" class="mt-0.5 h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" required />
                  <span>
                    <span id="register-accept-user-agreement-prefix">Я принимаю</span>
                    <a id="register-accept-user-agreement-link" href="/info/?tab=user-agreement" target="_blank" rel="noopener noreferrer" class="font-semibold text-indigo-700 underline underline-offset-2 hover:text-indigo-800">
                      Пользовательское соглашение
                    </a>
                  </span>
                </label>
                <label class="flex items-start gap-2 text-xs text-slate-700">
                  <input id="register-accept-privacy-policy" type="checkbox" class="mt-0.5 h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" required />
                  <span>
                    <span id="register-accept-privacy-policy-prefix">Я принимаю</span>
                    <a id="register-accept-privacy-policy-link" href="/info/?tab=privacy-policy" target="_blank" rel="noopener noreferrer" class="font-semibold text-indigo-700 underline underline-offset-2 hover:text-indigo-800">
                      Политику конфиденциальности
                    </a>
                  </span>
                </label>
              </div>
              <button class="w-full rounded-lg bg-indigo-600 px-5 py-2.5 text-center text-sm font-semibold text-white hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300" type="submit">Создать аккаунт</button>
            </form>
            <p id="register-status" class="text-sm text-slate-600"></p>
          </section>

          <section id="forgot-password-panel" class="hidden space-y-2 rounded-lg border border-slate-200 bg-slate-50 p-3">
            <form id="forgot-password-form" class="space-y-2">
              <input id="forgot-password-email" class="w-full rounded-lg border border-slate-300 bg-white p-2.5 text-sm text-slate-900 focus:border-indigo-500 focus:ring-indigo-500" type="email" placeholder="Email аккаунта" required />
              <button class="w-full rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100" type="submit">Отправить ссылку для сброса</button>
            </form>
            <p id="forgot-password-status" class="text-xs text-slate-600"></p>
          </section>

          <div id="reset-password-panel" class="hidden space-y-2 rounded-lg border border-emerald-200 bg-emerald-50 p-3">
            <p class="text-xs font-semibold uppercase tracking-wide text-emerald-700">Установка нового пароля</p>
            <form id="reset-password-form" class="space-y-2">
              <input id="reset-password-new" class="w-full rounded-lg border border-emerald-300 bg-white p-2.5 text-sm text-slate-900 focus:border-emerald-500 focus:ring-emerald-500" type="password" placeholder="Новый пароль" required />
              <input id="reset-password-confirm" class="w-full rounded-lg border border-emerald-300 bg-white p-2.5 text-sm text-slate-900 focus:border-emerald-500 focus:ring-emerald-500" type="password" placeholder="Повторите новый пароль" required />
              <button class="w-full rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-700" type="submit">Сменить пароль</button>
            </form>
            <p id="reset-password-status" class="text-xs text-emerald-800"></p>
          </div>

          <div id="register-verify-panel" class="hidden space-y-2 rounded-lg border border-sky-200 bg-sky-50 p-3">
            <p class="text-xs font-semibold uppercase tracking-wide text-sky-700">Подтверждение регистрации</p>
            <p id="register-verify-hint" class="text-xs text-slate-600"></p>
            <form id="register-verify-form" class="space-y-2">
              <input id="register-verify-code" class="w-full rounded-lg border border-sky-300 bg-white p-2.5 text-center text-lg tracking-[0.3em] text-slate-900 focus:border-sky-500 focus:ring-sky-500" inputmode="numeric" maxlength="6" placeholder="123456" required />
              <button class="w-full rounded-lg border border-sky-300 bg-white px-4 py-2 text-sm font-semibold text-sky-700 hover:bg-sky-100" type="submit">Подтвердить кодом</button>
            </form>
            <p id="register-verify-status" class="text-xs text-slate-600"></p>
          </div>

          <p id="auth-status" class="hidden text-sm text-slate-500"></p>
          <button id="logout-btn" class="hidden w-full rounded-lg bg-rose-500 px-5 py-2.5 text-center text-sm font-semibold text-white hover:bg-rose-600 focus:outline-none focus:ring-4 focus:ring-rose-200" type="button">Выйти</button>
        </div>
      </div>
    </div>
  </div>

  <div id="profile-modal" class="fixed inset-0 z-[1300] hidden h-full w-full overflow-y-auto bg-slate-50" aria-hidden="true">
    <div class="mx-auto flex min-h-full w-full max-w-5xl flex-col p-4 md:p-8">
      <div class="mb-6 flex items-center justify-between border-b border-slate-200 pb-4">
        <div>
          <h3 class="text-2xl font-extrabold text-slate-900 md:text-3xl">Личный кабинет</h3>
          <p id="profile-email" class="mt-1 text-sm text-slate-600"></p>
        </div>
        <button id="profile-modal-close" type="button" class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-slate-300 bg-white text-slate-600 hover:bg-slate-100" aria-label="Закрыть">
          <svg class="h-4 w-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 12 12M13 1 1 13"/>
          </svg>
        </button>
      </div>
      <div class="grid gap-4 md:grid-cols-2">
        <section class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
          <h4 class="text-lg font-semibold text-slate-900">Профиль</h4>
          <p class="mt-1 text-sm text-slate-500">Укажите имя и фамилию.</p>
          <form id="profile-form" class="mt-4 space-y-3">
            <input id="profile-first-name" class="w-full rounded-lg border border-slate-300 bg-slate-50 p-2.5 text-sm text-slate-900 focus:border-indigo-500 focus:ring-indigo-500" placeholder="Имя" />
            <input id="profile-last-name" class="w-full rounded-lg border border-slate-300 bg-slate-50 p-2.5 text-sm text-slate-900 focus:border-indigo-500 focus:ring-indigo-500" placeholder="Фамилия" />
            <button class="w-full rounded-lg border border-slate-300 bg-white px-5 py-2.5 text-center text-sm font-medium text-slate-700 hover:bg-slate-100 focus:outline-none focus:ring-4 focus:ring-slate-200" type="submit">Сохранить профиль</button>
          </form>
          <p id="profile-status" class="mt-3 text-sm text-slate-500"></p>
        </section>
        <section class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft">
          <h4 class="text-lg font-semibold text-slate-900">Смена пароля</h4>
          <p class="mt-1 text-sm text-slate-500">Введите текущий пароль и задайте новый.</p>
          <form id="change-password-form" class="mt-4 space-y-3">
            <input id="current-password" class="w-full rounded-lg border border-slate-300 bg-slate-50 p-2.5 text-sm text-slate-900 focus:border-indigo-500 focus:ring-indigo-500" type="password" placeholder="Текущий пароль" required />
            <input id="new-password" class="w-full rounded-lg border border-slate-300 bg-slate-50 p-2.5 text-sm text-slate-900 focus:border-indigo-500 focus:ring-indigo-500" type="password" placeholder="Новый пароль" required />
            <input id="new-password-confirm" class="w-full rounded-lg border border-slate-300 bg-slate-50 p-2.5 text-sm text-slate-900 focus:border-indigo-500 focus:ring-indigo-500" type="password" placeholder="Повторите новый пароль" required />
            <button class="w-full rounded-lg bg-indigo-600 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300" type="submit">Сменить пароль</button>
          </form>
          <p id="change-password-status" class="mt-3 text-sm text-slate-500"></p>
        </section>
        <section class="rounded-2xl border border-slate-200 bg-white p-5 shadow-soft md:col-span-2">
          <h4 class="text-lg font-semibold text-slate-900">Сеанс</h4>
          <p class="mt-1 text-sm text-slate-500">Вы можете завершить текущую сессию.</p>
          <button id="profile-logout-btn" class="mt-4 w-full rounded-lg bg-rose-500 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-rose-600 focus:outline-none focus:ring-4 focus:ring-rose-200" type="button">Выйти</button>
        </section>
      </div>
    </div>
  </div>

  <div id="search-modal" class="fixed inset-0 z-[1200] hidden pointer-events-none" aria-hidden="true">
    <div class="pointer-events-auto absolute left-2 right-2 bottom-2 top-[46%] flex flex-col overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-float md:inset-y-4 md:left-4 md:right-auto md:w-[calc(25%-1rem)] lg:w-[23%]">
      <div class="z-10 flex items-center justify-between border-b border-slate-200 bg-white/95 p-4 backdrop-blur md:p-5">
        <h3 class="text-xl font-semibold text-gray-900">Поиск зданий</h3>
        <button id="search-modal-close" type="button" class="inline-flex h-8 w-8 items-center justify-center rounded-lg text-sm text-gray-400 hover:bg-gray-100 hover:text-gray-900" aria-label="Закрыть">
          <svg class="h-3 w-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 12 12M13 1 1 13"/>
          </svg>
        </button>
      </div>
      <div class="flex min-h-0 flex-1 flex-col gap-3 px-3 pt-3 pb-4 md:px-4 md:pt-4 md:pb-5">
        <form id="search-modal-form" class="md:hidden">
          <label for="search-modal-input" class="group flex h-10 items-center gap-2 rounded-lg border border-slate-300 bg-white px-3 shadow-soft transition focus-within:border-indigo-500 focus-within:ring-2 focus-within:ring-indigo-200">
            <svg viewBox="0 0 640 640" width="15" height="15" aria-hidden="true" class="fill-current text-slate-500 transition group-focus-within:text-indigo-600">
              <path d="M480 272C480 317.9 465.1 360.3 440 394.7L566.6 521.4C579.1 533.9 579.1 554.2 566.6 566.7C554.1 579.2 533.8 579.2 521.3 566.7L394.7 440C360.3 465.1 317.9 480 272 480C157.1 480 64 386.9 64 272C64 157.1 157.1 64 272 64C386.9 64 480 157.1 480 272zM272 416C351.5 416 416 351.5 416 272C416 192.5 351.5 128 272 128C192.5 128 128 192.5 128 272C128 351.5 192.5 416 272 416z"></path>
            </svg>
            <input id="search-modal-input" type="search" placeholder="Поиск по всей локальной базе" class="h-full w-full border-0 bg-transparent text-sm text-slate-900 placeholder:text-slate-500 focus:outline-none" autocomplete="off" />
          </label>
        </form>
        <p id="search-results-status" class="text-sm text-slate-600">Введите запрос для поиска по всей базе зданий.</p>
        <div id="search-results-list" class="min-h-0 flex-1 space-y-2 overflow-y-auto pr-1"></div>
        <button id="search-load-more-btn" type="button" class="hidden w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-100">
          Показать ещё
        </button>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/maplibre-gl@5.1.0/dist/maplibre-gl.js"></script>
  <script src="https://unpkg.com/pmtiles@4.3.0/dist/pmtiles.js"></script>
  <script src="/app-config.js"></script>
  <script src="/i18n/ru.js"></script>
  <script src="/shared/text-utils.js"></script>
  <script src="/shared/ui.js"></script>
  <script src="/shared/top-nav-templates.js"></script>
  <script src="/shared/top-nav.js"></script>
  <script>window.ArchiMapTopNav.render({ context: 'index' });</script>
  <script src="/main/map/map-module.js"></script>
  <script src="/main/auth/auth-module.js"></script>
  <script src="/main/search/search-module.js"></script>
  <script src="/main/modal/modal-module.js"></script>
  <script src="/main/filters/filters-module.js"></script>
  <script src="/styles/local-buildings-style.js"></script>
  <script src="/main.js"></script>
</body>
</html>

