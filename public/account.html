<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="account-page-title">Личный кабинет | archimap</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link href="https://unpkg.com/maplibre-gl@5.1.0/dist/maplibre-gl.css" rel="stylesheet" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ["Manrope", "Segoe UI", "Roboto", "Arial", "sans-serif"]
          },
          colors: {
            brand: {
              purple: "#5B62F0"
            }
          },
          boxShadow: {
            soft: "0 8px 24px rgba(15, 23, 42, 0.08)"
          }
        }
      }
    };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    (function applyInitialTheme() {
      const key = 'archimap-theme';
      let theme = 'light';
      try {
        const stored = localStorage.getItem(key);
        if (stored === 'light' || stored === 'dark') {
          theme = stored;
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          theme = 'dark';
        }
      } catch {
        theme = 'light';
      }
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="min-h-screen bg-slate-100 font-sans text-slate-900">
  <div id="top-nav-root"></div>

  <div id="account-layout" class="page-with-edit-pane w-full px-3 pb-5 pt-[5.5rem] sm:px-4 sm:pb-6 sm:pt-[5.25rem]">
    <div class="w-full">
      <section class="rounded-2xl border border-slate-200 bg-white/95 p-4 shadow-soft backdrop-blur-sm sm:p-5">
        <div class="border-b border-slate-200 pb-4">
          <h1 id="account-heading" class="text-2xl font-extrabold">Личный кабинет</h1>
          <p id="account-subtitle" class="mt-1 text-sm text-slate-600">Загрузка данных...</p>
        </div>

        <div class="mt-4">
          <ul class="ui-tab-shell flex flex-wrap gap-1" id="account-tabs" data-tabs-toggle="#account-tabs-content" role="tablist">
            <li role="presentation">
              <button id="account-tab-settings" type="button" role="tab" class="ui-tab-btn">Настройки</button>
            </li>
            <li role="presentation">
              <button id="account-tab-edits" type="button" role="tab" class="ui-tab-btn">Мои правки</button>
            </li>
          </ul>
        </div>

        <div id="account-tabs-content" class="mt-4 space-y-4">
          <section id="account-profile-panel" class="rounded-2xl border border-slate-200 bg-white p-6">
          <h2 id="account-settings-title" class="text-lg font-bold text-slate-900">Настройки профиля</h2>
          <p id="account-settings-hint" class="mt-1 text-sm text-slate-600">Личные данные, безопасность и уведомления в одном разделе.</p>
          <div class="mt-5 grid gap-4 xl:grid-cols-3">
            <section class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
              <h3 id="account-personal-title" class="text-base font-bold text-slate-900">Личные данные</h3>
              <form id="profile-form" class="mt-4 space-y-4">
                <div>
                  <label id="account-label-first-name" for="first-name" class="mb-1 block text-sm font-medium text-slate-700">Имя</label>
                  <input id="first-name" type="text" class="ui-field bg-white" autocomplete="given-name" placeholder="Иван" />
                </div>
                <div>
                  <label id="account-label-last-name" for="last-name" class="mb-1 block text-sm font-medium text-slate-700">Фамилия</label>
                  <input id="last-name" type="text" class="ui-field bg-white" autocomplete="family-name" placeholder="Иванов" />
                </div>
                <div>
                  <label id="account-label-email" for="profile-email" class="mb-1 block text-sm font-medium text-slate-700">Email</label>
                  <input id="profile-email" type="email" class="ui-field bg-white text-slate-500" readonly value="user@archimap.app" />
                </div>
                <button id="account-profile-save-btn" type="submit" class="ui-btn ui-btn-primary">Сохранить</button>
                <p id="profile-status" class="text-sm text-slate-600"></p>
              </form>
            </section>

            <section class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
              <h3 id="account-security-title" class="text-base font-bold text-slate-900">Безопасность</h3>
              <form id="password-form" class="mt-4 space-y-4">
                <div>
                  <label id="account-label-current-password" for="current-password" class="mb-1 block text-sm font-medium text-slate-700">Текущий пароль</label>
                  <input id="current-password" type="password" required class="ui-field bg-white" autocomplete="current-password" />
                </div>
                <div>
                  <label id="account-label-new-password" for="new-password" class="mb-1 block text-sm font-medium text-slate-700">Новый пароль</label>
                  <input id="new-password" type="password" required class="ui-field bg-white" autocomplete="new-password" />
                </div>
                <div>
                  <label id="account-label-new-password-confirm" for="new-password-confirm" class="mb-1 block text-sm font-medium text-slate-700">Повторите новый пароль</label>
                  <input id="new-password-confirm" type="password" required class="ui-field bg-white" autocomplete="new-password" />
                </div>
                <button id="account-password-save-btn" type="submit" class="ui-btn ui-btn-outline-brand">Изменить пароль</button>
                <p id="password-status" class="text-sm text-slate-600"></p>
              </form>
            </section>

            <section class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
              <h3 id="account-notifications-title" class="text-base font-bold text-slate-900">Уведомления</h3>
              <div class="mt-4 space-y-4">
                <div class="flex items-start justify-between gap-3 rounded-2xl border border-slate-200 bg-white p-4">
                  <div>
                    <p id="account-notify-comments-title" class="text-sm font-semibold text-slate-900">Новые комментарии к правкам</p>
                    <p id="account-notify-comments-hint" class="mt-1 text-sm text-slate-500">Письмо, когда администратор комментирует вашу правку.</p>
                  </div>
                  <label class="relative inline-flex cursor-pointer items-center">
                    <input type="checkbox" class="peer sr-only" checked>
                    <div class="h-6 w-11 rounded-full bg-slate-300 after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-slate-300 after:bg-white after:transition-all peer-checked:bg-brand-purple peer-checked:after:translate-x-full peer-checked:after:border-white"></div>
                  </label>
                </div>
                <div class="flex items-start justify-between gap-3 rounded-2xl border border-slate-200 bg-white p-4">
                  <div>
                    <p id="account-notify-moderation-title" class="text-sm font-semibold text-slate-900">Статус модерации</p>
                    <p id="account-notify-moderation-hint" class="mt-1 text-sm text-slate-500">Уведомления об одобрении или отклонении изменений.</p>
                  </div>
                  <label class="relative inline-flex cursor-pointer items-center">
                    <input type="checkbox" class="peer sr-only" checked>
                    <div class="h-6 w-11 rounded-full bg-slate-300 after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-slate-300 after:bg-white after:transition-all peer-checked:bg-brand-purple peer-checked:after:translate-x-full peer-checked:after:border-white"></div>
                  </label>
                </div>
                <div class="flex items-start justify-between gap-3 rounded-2xl border border-slate-200 bg-white p-4">
                  <div>
                    <p id="account-notify-weekly-title" class="text-sm font-semibold text-slate-900">Еженедельная сводка</p>
                    <p id="account-notify-weekly-hint" class="mt-1 text-sm text-slate-500">Подборка ваших активностей и новых объектов на карте.</p>
                  </div>
                  <label class="relative inline-flex cursor-pointer items-center">
                    <input type="checkbox" class="peer sr-only">
                    <div class="h-6 w-11 rounded-full bg-slate-300 after:absolute after:left-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-slate-300 after:bg-white after:transition-all peer-checked:bg-brand-purple peer-checked:after:translate-x-full peer-checked:after:border-white"></div>
                  </label>
                </div>
              </div>
            </section>

            <section class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
              <h3 id="account-legal-title" class="text-base font-bold text-slate-900">Правовая информация</h3>
              <p id="account-legal-hint" class="mt-1 text-sm text-slate-600">Соглашения и политика конфиденциальности доступны в разделе информации.</p>
              <div class="mt-4 space-y-2">
                <a id="account-legal-user-agreement-link" href="/info/?tab=user-agreement" class="block rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-indigo-700 underline underline-offset-2 hover:bg-slate-50">Пользовательское соглашение</a>
                <a id="account-legal-privacy-link" href="/info/?tab=privacy-policy" class="block rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-indigo-700 underline underline-offset-2 hover:bg-slate-50">Политика конфиденциальности</a>
              </div>
            </section>
          </div>
          </section>

          <section id="account-edits-panel" class="hidden space-y-4">
          <div class="overflow-hidden rounded-2xl border border-slate-200 bg-white">
            <div id="account-edits-map" class="h-[340px] w-full"></div>
          </div>

          <div class="rounded-2xl border border-slate-200 bg-white p-4">
            <div class="grid gap-3 lg:grid-cols-[1.6fr_repeat(2,minmax(0,1fr))]">
              <input id="account-edits-search" type="search" placeholder="Поиск по адресу или ID здания" class="ui-field" />
              <input id="account-edits-date-filter" type="date" class="ui-field" />
              <p id="account-edits-status" class="flex items-center rounded-[16px] border border-slate-200 bg-white px-4 py-2.5 text-sm text-slate-600">Загрузка...</p>
            </div>
          </div>

          <div class="overflow-hidden rounded-2xl border border-slate-200 bg-white">
            <div class="overflow-x-auto">
              <table class="w-full text-left text-sm text-slate-700">
                <thead class="bg-slate-50 text-xs uppercase tracking-wide text-slate-500">
                  <tr>
                    <th id="account-edits-col-object" class="px-4 py-3">Объект</th>
                    <th id="account-edits-col-author" class="px-4 py-3">Автор</th>
                    <th id="account-edits-col-status" class="px-4 py-3">Статус</th>
                    <th id="account-edits-col-changes" class="px-4 py-3">Изменения тегов</th>
                  </tr>
                </thead>
                <tbody id="account-edits-list">
                  <tr class="cursor-pointer border-t border-slate-200 hover:bg-slate-50">
                    <td class="px-4 py-3">
                      <button type="button" data-action="open-edit" data-edit-key="way/14598322" class="text-left">
                        <p class="font-semibold text-slate-900">ул. Рождественская, 10</p>
                        <p class="text-xs text-slate-500">ID: way/14598322</p>
                      </button>
                    </td>
                    <td class="px-4 py-3 text-slate-600">you@example.com</td>
                    <td class="px-4 py-3"><span class="rounded-full bg-amber-100 px-2.5 py-1 text-xs font-semibold text-amber-700">На рассмотрении</span></td>
                    <td class="px-4 py-3">
                      <div class="flex flex-wrap items-center gap-2">
                        <span class="rounded-md bg-slate-100 px-2 py-1 text-xs text-slate-600">4 всего</span>
                        <span class="rounded-md bg-emerald-50 px-2 py-1 text-xs text-emerald-600">+1 создано</span>
                        <span class="rounded-md bg-blue-50 px-2 py-1 text-xs text-blue-600">~3 изменено</span>
                      </div>
                    </td>
                  </tr>
                  <tr class="cursor-pointer border-t border-slate-200 hover:bg-slate-50">
                    <td class="px-4 py-3">
                      <button type="button" data-action="open-edit" data-edit-key="relation/8192631" class="text-left">
                        <p class="font-semibold text-slate-900">пр-т Гагарина, 58</p>
                        <p class="text-xs text-slate-500">ID: relation/8192631</p>
                      </button>
                    </td>
                    <td class="px-4 py-3 text-slate-600">you@example.com</td>
                    <td class="px-4 py-3"><span class="rounded-full bg-rose-100 px-2.5 py-1 text-xs font-semibold text-rose-700">Отклонено</span></td>
                    <td class="px-4 py-3">
                      <div class="flex flex-wrap items-center gap-2">
                        <span class="rounded-md bg-slate-100 px-2 py-1 text-xs text-slate-600">2 всего</span>
                        <span class="rounded-md bg-blue-50 px-2 py-1 text-xs text-blue-600">~2 изменено</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          </section>
        </div>
      </section>
    </div>
  </div>

  <div id="edit-detail-pane-root"></div>

  <script src="https://unpkg.com/maplibre-gl@5.1.0/dist/maplibre-gl.js"></script>
  <script src="https://unpkg.com/pmtiles@4.3.0/dist/pmtiles.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.5.2/flowbite.min.js"></script>
  <script src="/app-config.js"></script>
  <script src="/i18n/ru.js"></script>
  <script src="/shared/text-utils.js"></script>
  <script src="/shared/ui.js"></script>
  <script src="/shared/top-nav-templates.js"></script>
  <script src="/shared/top-nav.js"></script>
  <script src="/shared/panel-page.js"></script>
  <script>window.ArchiMapTopNav.render({ context: 'account' });</script>
  <script>
    (function renderSharedEditPane() {
      var root = document.getElementById('edit-detail-pane-root');
      if (!root || !window.ArchiMapUI || typeof window.ArchiMapUI.editDetailPane !== 'function') return;
      root.innerHTML = window.ArchiMapUI.editDetailPane();
    })();
  </script>
  <script src="/account.js"></script>
</body>
</html>
